# SOS 倒计时功能

## 功能概述

在90秒陪伴对话过程中，页面顶部中央会显示一个**梦幻风格的小倒计时**，让用户清楚知道还剩多少时间。

## 视觉设计

### 位置
```
对话界面顶部
   ↓
中央位置（居中）
   ↓
距离顶部 60px
```

### 样式设计

#### 尺寸与形状
- **容器**：48px × 48px
- **形状**：圆形
- **位置**：绝对定位，水平居中

#### 视觉层次

1. **光晕层**（背景）
   ```typescript
   backgroundColor: 'rgba(255, 255, 255, 0.1)'
   shadowColor: white
   shadowOpacity: 0.3
   shadowRadius: 12
   ```

2. **数字层**（前景）
   ```typescript
   fontSize: 20
   fontWeight: '300'
   color: 'rgba(255, 255, 255, 0.8)'
   letterSpacing: 1
   ```

### 设计理念

#### 极简主义
- 只显示数字，无单位
- 无边框，无额外装饰
- 轻量的存在感

#### 梦幻风格
- 半透明背景
- 柔和的光晕效果
- 细字体（300）
- 字间距增加呼吸感

#### 非侵入性
- 小尺寸（48px）
- 低对比度（0.8透明度）
- 不抢夺注意力
- 与整体氛围和谐

## 技术实现

### 状态管理
```typescript
const [countdown, setCountdown] = useState(90);
```

### 倒计时逻辑
```typescript
// 每秒递减
const countdownInterval = setInterval(() => {
  setCountdown((prev) => {
    if (prev <= 1) {
      clearInterval(countdownInterval);
      return 0;
    }
    return prev - 1;
  });
}, 1000);

// 90秒后清理
setTimeout(() => {
  clearInterval(countdownInterval);
  setIsInDialogue(false);
  setShowResultModal(true);
}, 90000);
```

### 显示逻辑
```jsx
<View style={styles.countdownContainer}>
  <View style={styles.countdownGlow} />
  <Text style={styles.countdownText}>{countdown}</Text>
</View>
```

## 交互流程

### 完整时间轴
```
0秒:  显示 90
1秒:  显示 89
2秒:  显示 88
...
88秒: 显示 2
89秒: 显示 1
90秒: 显示 0 → 结算卡片弹出
```

### 用户体验
```
点击「我需要缓一缓」
    ↓
进入对话界面
    ↓
看到顶部中央倒计时「90」
    ↓
每秒递减（89、88、87...）
    ↓
对话消息逐条出现
    ↓
倒计时到「0」
    ↓
自动弹出结算卡片
```

## 视觉对比

### 改进前
```
对话界面
- 只有对话消息
- 不知道还剩多少时间
- 可能感到焦虑
```

### 改进后
```
对话界面
- 顶部小倒计时
- 清楚知道进度
- 心中有数，更放松
```

## 心理学考量

### 透明度（时间可见性）
- **好处**：减少不确定性
- **设计**：小巧不抢眼
- **效果**：知道时间但不焦虑

### 低对比度设计
- **为什么**：避免制造时间压力
- **实现**：0.8透明度，300字重
- **效果**：存在但不刺激

### 圆形设计
- **象征**：完整、循环
- **感受**：柔和、包容
- **避免**：方形的紧张感

## 数字变化细节

### 字体选择
- **字重**：300（轻盈）
- **字号**：20（适中）
- **字间距**：1（呼吸感）

### 数字格式
- **90-10**：两位数
- **9-1**：一位数
- **0**：单个零

### 无额外装饰
- ❌ 不显示"秒"
- ❌ 不显示进度条
- ❌ 不显示百分比
- ✅ 只显示纯数字

## 布局调整

### 内容区域适配
```typescript
dialogueContent: {
  padding: 24,
  paddingTop: 120,  // 从80增加到120
  paddingBottom: 100,
}
```

**原因**：为倒计时留出空间，避免遮挡对话内容

### Z轴层级
```typescript
countdownContainer: {
  zIndex: 10,  // 确保在顶层
}
```

## 交互示例

### 正常流程
```
用户点击 → 倒计时开始
90秒 → 「你来了。」
89秒 → 
88秒 → 
87秒 → 「现在不需要想清楚发生了什么。」
...
20秒 → 「这种时候，真的挺难的。」
...
1秒  → 
0秒  → 结算卡片
```

### 提前退出
```
用户点击 → 倒计时开始
90秒 → 「你来了。」
...
60秒 → 用户点击「我想先退出」
    → 倒计时停止
    → 结算卡片弹出
```

## 性能优化

### 内存管理
- 使用 `setInterval` 而非递归 `setTimeout`
- 90秒后自动清理 interval
- 提前退出时也清理 interval

### 避免内存泄漏
```typescript
setTimeout(() => {
  clearInterval(countdownInterval);  // 确保清理
  setIsInDialogue(false);
  setShowResultModal(true);
}, 90000);
```

## 设计哲学

### 为什么需要倒计时？

1. **减少焦虑**
   - 知道还要等多久
   - 心中有数
   - 不会感到无尽等待

2. **建立信任**
   - 透明的时间显示
   - 说90秒就是90秒
   - 不欺骗用户

3. **增强控制感**
   - 看到进度
   - 可以选择退出
   - 不是被动等待

### 为什么要小而淡？

1. **避免时间压力**
   - 不强调时间流逝
   - 不制造紧张感
   - 只是提供信息

2. **保持情绪焦点**
   - 主角是对话内容
   - 不是倒计时
   - 时间只是辅助

3. **符合整体氛围**
   - 梦幻、柔和
   - 低调、温和
   - 陪伴不干扰

## 未来可能的增强（可选）

### 数字动画
- [ ] 数字切换时的淡入淡出
- [ ] 轻微的缩放效果
- [ ] 脉动动画（呼应呼吸）

### 视觉反馈
- [ ] 最后10秒颜色变化
- [ ] 进度环（可选）
- [ ] 粒子效果（可选）

### 保持克制
- ✓ 不添加声音提示
- ✓ 不添加震动提示
- ✓ 不添加闪烁效果
- ✓ 保持当前的简洁

---

**设计原则**：  
时间应该被看见，但不应该被强调。
